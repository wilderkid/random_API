项目需求文档 (PRD) - V1.0
项目名称: Random_API
文档版本: 1.0
创建日期: 2026年1月3日
项目负责人: [wildkid]
核心目标: 开发一款 Web 应用，用于统一管理和调用多个第三方 AI 大模型 API，提供轮询、参数统一配置等高级功能，以提升调用效率和灵活性。

1. 项目概述与架构
1.1. 项目简介
Random_API 是一个前后端分离的 Web 应用。它允许用户集成多个遵循 OpenAI API 规范的第三方平台，并在一个统一的界面中与这些平台的模型进行对话。项目核心功能包括多 API 源管理、灵活的模型选择、统一的参数配置以及智能的轮询调用机制。

1.2. 技术架构
平台: Web 应用
架构模式: 前后端分离
后端 (Backend):
框架: Node.js + Express.js
职责:
提供 RESTful API 供前端调用。
处理所有与第三方 AI API 的 HTTP 通信（作为代理）。
管理和读写本地配置文件（API 源、用户设置等）。
实现核心业务逻辑（轮询、重试、频率控制）。
记录操作和错误日志。
前端 (Frontend):
框架/工具: Vue.js 3 + Vite
职责:
构建用户交互界面。
处理用户输入和界面状态管理。
通过 HTTP 请求与后端服务进行数据交换。
实时渲染流式输出的 AI 回复。
数据存储:
位置: 项目根目录下的 data/ 文件夹。
结构:
data/api_settings.json: 存储所有 API 提供商的配置信息。
data/conversations/: 存储每个对话的历史记录，每个对话一个 JSON 文件。
data/user_settings.json: 存储用户的默认参数、UI 设置等。
data/logs/: 存储 .log 格式的日志文件。
1.3. 运行与部署
开发模式: 前后端分离启动。前端使用 Vite 服务器 (npm run dev)，后端使用 Node (node server.js)。
生产模式: 前端构建为静态文件 (HTML/CSS/JS)，由 Express 后端统一托管。用户只需启动后端服务，即可通过浏览器访问完整应用。
2. 功能需求详述
2.1. API 提供商管理 (/settings/apis)
功能描述: 用户在此页面管理所有第三方 API 的凭证和信息。
界面元素:
API 列表: 以表格或卡片形式展示所有已添加的 API 提供商。每项应包含：
提供商名称 (可编辑)
基础 URL (可编辑)
API Key (部分隐藏，可编辑)
操作按钮：“编辑”、“删除”、“获取模型列表”。
模型展示区: 点击“获取模型列表”后，在当前提供商条目下方或弹窗中展示其拥有的模型列表。若获取失败，则在原处显示红色错误提示信息。
添加/编辑表单: 通过弹窗或独立页面提供，包含“名称”、“基础 URL”、“API Key”三个输入字段。
2.2. 核心聊天界面 (/)
功能描述: 用户进行 AI 对话的主要工作区。
界面布局 (三栏式):
左侧边栏 (对话列表):
展示所有历史对话的列表。
对话标题自动采用用户发送的第一句话内容。
提供搜索框，用于实时过滤对话列表。
支持单个删除和批量选择删除。
中间主窗口 (对话区):
顶部: 显示当前对话选择的模型信息，格式为 提供商名称 - 模型名称。这是一个下拉菜单，允许用户为当前对话切换模型。
下拉菜单内容: 直接展示所有可用模型的扁平列表，每一项都清晰标注提供商和模型名（例如 服务商A - gpt-4, 服务商B - gpt-4），不使用二级联动菜单。
中部: 对话记录展示区，支持 Markdown 渲染和代码高亮。
底部 (输入区):
输入框: 多行文本输入框。
工具栏: 始终显示在输入框上方或下方，包含以下控件：
参数配置按钮: 点击后弹出模态框，用于设置本次调用的 温度, 最大长度, top_p 等。
轮询开关: 一个 Toggle Switch，用于开启/关闭轮询模式。
频率限制设置: 一个输入框或下拉菜单，用于设定 API 调用频率。
发送按钮。
2.3. 轮询调用配置 (/settings/polling)
功能描述: 用户在此页面定义和管理模型的轮询行为。
界面布局 (三栏式):
左栏 (可用池):
按“模型名”自动分组所有重复的模型（例如 gpt-4 (3)）。
分组可展开，显示拥有该模型的具体提供商列表。
支持拖拽排序: 用户可以拖动调整提供商的顺序，此顺序即为轮询调用的顺序。
提供一个“->”按钮，用于将选中的模型移至“排除池”。
中栏 (排除池):
存放用户不希望参与轮询的重复模型。
提供一个“<-”按钮，用于将选中的模型移回“可用池”。
右栏 (禁用状态栏):
只读区域，用于展示当前因连续调用失败而被系统自动禁用的模型。
每项应显示模型名、所属提供商、禁用原因（如“连续3次请求失败”）。
提供一个 “重新启用”按钮，允许用户手动解除该模型的禁用状态。
2.4. 用户设置 (/settings/defaults)
功能描述: 用户配置全局默认参数和偏好。
配置项:
默认模型参数: 温度, 最大长度, top_p 等。新对话将使用这些默认值。
全局调用频率: 设置一个全局的 API 请求频率限制。
主题切换: （远期规划）提供浅色/深色模式切换选项。
2.5. 日志查看 (/logs)
功能描述: 提供一个界面供用户查看系统运行日志。
功能:
读取并展示 data/logs/ 目录下的日志文件内容。
提供按日期筛选日志的功能。
提供清空当前日志文件的按钮。
3. 核心业务逻辑规则
3.1. API 地址构建规则
逻辑: 必须智能处理用户输入的基础 URL。
检查基础 URL 是否以 /v[数字] 或 /v[数字]/ 结尾。
如果匹配: 最终请求 URL = 基础 URL (标准化，去除尾部斜杠) + / + 请求路径 (如 chat/completions)。
如果不匹配: 最终请求 URL = 基础 URL (标准化) + /v1/ + 请求路径。
必须处理好 URL 拼接中的双斜杠问题。
3.2. 模型名称解析规则
逻辑: 为了识别同名模型，需从模型 ID 中提取“模型名”。
如果模型 ID (如 siliconflow/deepseek-v3.2) 包含 /，则取最后一个 / 之后的部分 (deepseek-v3.2)作为模型名。
如果模型 ID 不含 /，则直接使用完整 ID 作为模型名。
3.3. 轮询执行逻辑
触发条件: 用户在聊天界面开启“轮询开关”并发起请求。
执行流程:
后端接收请求，获取当前对话选择的模型名。
在“可用池”中查找该模型名对应的提供商列表。
按照用户在轮询配置页面设定的提供商顺序，从第一个开始，选择一个未被禁用的模型进行调用。
如果调用成功，返回结果。本次轮询结束。
如果调用失败（HTTP 状态码非 200 或超时），立即为该模型记录一次失败，并跳过，尝试列表中的下一个模型。
如果轮询完所有可用模型都失败，则向前端返回最终的错误信息。
3.4. 自动禁用与重试机制
禁用规则: 当某个特定模型（例如 服务商A 的 gpt-4）连续调用失败 3 次后，系统自动将其状态置为“禁用”。
禁用影响: 被禁用的模型将在轮询时被自动跳过，并且在常规选择时可能标记为不可用。
手动启用: 用户可以通过轮询配置页面的“重新启用”按钮，或在 API 管理页面进行操作，来清除模型的禁用状态和失败计数。
4. 非功能性需求
4.1. UI/UX
背景风格: 采用苹果风格的毛玻璃效果，背景为青色与粉色的模糊光斑。
交互动画: 所有交互元素（按钮悬浮、菜单展开、模态框弹出等）应有平滑、轻量且不影响性能的过渡动画。
响应式: （远期规划）界面应能适应不同尺寸的浏览器窗口。
4.2. 性能
流式输出: 与大模型的通信必须默认采用流式（Server-Sent Events），以实现打字机效果，提升用户体验。
前端性能: 优化 Vue 组件，避免不必要的渲染，确保长对话列表和复杂界面下的流畅性。
4.3. 安全
API Key: 虽然初期存储在 JSON 文件中，但前端绝不能直接接触到明文 Key。所有 Key 的存储和使用都必须在后端完成。