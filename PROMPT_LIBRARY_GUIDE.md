# 提示词库功能说明

## 功能概述

提示词库是一个独立的系统提示词管理模块，允许用户创建、管理和使用预设的系统提示词。该功能仅在内部聊天功能中生效，不影响对外提供的 API 接口。

## 功能特性

### 1. 提示词管理
- ✅ 创建、编辑、删除提示词
- ✅ 为提示词添加名称、描述和内容
- ✅ 支持长文本提示词（无字数限制）
- ✅ 显示创建和更新时间

### 2. 分组管理
- ✅ 创建自定义分组
- ✅ 将提示词分配到不同分组
- ✅ 编辑和删除分组（默认分组不可删除）
- ✅ 删除分组时自动将提示词移至默认分组

### 3. 标签系统
- ✅ 为提示词添加多个标签
- ✅ 通过标签筛选提示词
- ✅ 自动收集所有使用过的标签

### 4. 搜索和筛选
- ✅ 全文搜索（名称、描述、内容）
- ✅ 按分组筛选
- ✅ 按标签筛选
- ✅ 支持多标签组合筛选

### 5. 聊天集成
- ✅ 在聊天参数配置中选择提示词
- ✅ 实时预览选中的提示词内容
- ✅ 发送消息时自动包含系统提示词
- ✅ 支持 OpenAI 和 Anthropic 两种 API 格式

### 6. 默认提示词设置
- ✅ 在用户设置中配置默认提示词
- ✅ 打开聊天页面时自动选择默认提示词
- ✅ 实时预览默认提示词内容
- ✅ 可随时在聊天中更改

## 使用指南

### 访问提示词库

1. 启动应用后，在顶部导航栏点击 **"提示词库"**
2. 进入提示词管理页面

### 创建提示词

1. 点击左侧边栏的 **"+ 新建提示词"** 按钮
2. 填写以下信息：
   - **名称**：提示词的标题（必填）
   - **描述**：简短说明提示词的用途
   - **所属分组**：选择分组（默认为"默认分组"）
   - **标签**：添加相关标签（输入后按回车）
   - **提示词内容**：输入系统提示词的完整内容（必填）
3. 点击 **"保存"** 按钮

### 编辑提示词

1. 在左侧列表中选择要编辑的提示词
2. 点击右侧详情面板的 **"编辑"** 按钮
3. 修改内容后点击 **"保存"**
4. 点击 **"取消"** 可放弃修改

### 删除提示词

1. 选择要删除的提示词
2. 点击右上角的 **"×"** 按钮
3. 确认删除操作

### 管理分组

1. 点击左侧边栏的 **"📁 管理分组"** 按钮
2. 在弹窗中可以：
   - 编辑现有分组的名称和描述
   - 点击 **"+ 新建分组"** 创建新分组
   - 点击 **"删除"** 删除分组（默认分组除外）
3. 修改会自动保存

### 在聊天中使用提示词

1. 进入聊天页面
2. 点击工具栏的 **"参数配置"** 按钮
3. 在弹出的配置面板中：
   - 找到 **"系统提示词"** 下拉框
   - 选择要使用的提示词
   - 下方会显示提示词的预览
4. 关闭配置面板
5. 正常发送消息，系统会自动将选中的提示词作为系统提示词发送

**注意**：
- 选择"无（不使用提示词）"可以取消系统提示词
- 提示词会在每次发送消息时自动包含
- 切换提示词后立即生效

### 设置默认提示词

1. 点击导航栏的 **"用户设置"**
2. 在左侧配置列表中选择 **"默认提示词"**
3. 在下拉框中选择要设置为默认的提示词
4. 可以在下方预览提示词内容
5. 点击 **"保存设置"**

**效果**：
- 设置后，每次打开聊天页面时会自动选择该提示词
- 无需每次手动选择
- 可以随时在聊天参数配置中更改

## 数据存储

### 数据文件位置
```
data/prompts.json
```

### 数据结构
```json
{
  "prompts": [
    {
      "id": "1738123456789",
      "name": "专业翻译助手",
      "description": "帮助进行中英文翻译",
      "content": "你是一个专业的翻译助手...",
      "groupId": "default",
      "tags": ["翻译", "语言"],
      "createdAt": "2026-01-29T12:00:00.000Z",
      "updatedAt": "2026-01-29T12:00:00.000Z"
    }
  ],
  "groups": [
    {
      "id": "default",
      "name": "默认分组",
      "description": "未分组的提示词"
    }
  ]
}
```

## API 接口

### 提示词管理

#### 获取所有提示词
```
GET /api/prompts
```

#### 创建提示词
```
POST /api/prompts
Body: {
  "name": "提示词名称",
  "description": "描述",
  "content": "提示词内容",
  "groupId": "分组ID",
  "tags": ["标签1", "标签2"]
}
```

#### 更新提示词
```
PUT /api/prompts/:id
Body: { ...更新的字段 }
```

#### 删除提示词
```
DELETE /api/prompts/:id
```

### 分组管理

#### 获取所有分组
```
GET /api/prompt-groups
```

#### 创建分组
```
POST /api/prompt-groups
Body: {
  "name": "分组名称",
  "description": "描述"
}
```

#### 更新分组
```
PUT /api/prompt-groups/:id
Body: { ...更新的字段 }
```

#### 删除分组
```
DELETE /api/prompt-groups/:id
```

### 标签管理

#### 获取所有标签
```
GET /api/prompt-tags
```
返回所有提示词中使用过的唯一标签列表。

## 技术实现

### 后端实现

1. **数据存储**：使用 JSON 文件存储，支持缓存机制（5秒 TTL）
2. **API 格式支持**：
   - OpenAI 格式：将系统提示词作为第一条消息插入
   - Anthropic 格式：使用 `system` 字段传递系统提示词
3. **缓存优化**：提示词数据使用内存缓存，减少文件读取

### 前端实现

1. **独立页面**：`PromptLibrary.vue` 提供完整的管理界面
2. **聊天集成**：在 `Chat.vue` 中添加提示词选择功能
3. **实时预览**：选择提示词后立即显示内容预览
4. **响应式设计**：采用毛玻璃效果，与整体风格一致

### 关键代码位置

#### 后端
- 数据文件定义：`backend/server.js` 第 51 行
- 提示词 API：`backend/server.js` 第 608-795 行
- 聊天接口修改：`backend/server.js` 第 817 行（接收 systemPrompt）
- 请求体构建：`backend/server.js` 第 1017-1095 行（buildChatRequestBody 函数）

#### 前端
- 提示词管理页面：`frontend/src/views/PromptLibrary.vue`
- 路由配置：`frontend/src/main.js` 第 10、20 行
- 导航入口：`frontend/src/App.vue` 第 11 行
- 聊天集成：`frontend/src/views/Chat.vue`
  - 数据定义：第 660-661 行
  - 选择界面：第 98-119 行
  - 发送逻辑：第 1013 行

## 注意事项

1. **不影响外部 API**：提示词功能仅在内部聊天界面生效，不会影响 `/v1/chat/completions` 等对外提供的 API 接口
2. **数据备份**：建议定期备份 `data/prompts.json` 文件
3. **性能考虑**：提示词内容会在每次请求时发送，建议控制提示词长度在合理范围内
4. **兼容性**：支持 OpenAI 和 Anthropic 两种 API 格式，自动适配

## 示例提示词

### 专业翻译助手
```
你是一个专业的翻译助手，精通中英文翻译。请遵循以下规则：
1. 准确传达原文含义
2. 保持专业术语的准确性
3. 注意语境和文化差异
4. 提供自然流畅的译文
```

### 代码审查专家
```
你是一个经验丰富的代码审查专家。在审查代码时，请关注：
1. 代码质量和可读性
2. 潜在的 bug 和安全问题
3. 性能优化建议
4. 最佳实践和设计模式
请提供具体、可操作的改进建议。
```

### 创意写作助手
```
你是一个富有创意的写作助手。请帮助用户：
1. 构思故事情节和人物设定
2. 提供生动的描写和对话
3. 保持叙事的连贯性和吸引力
4. 根据用户需求调整写作风格
```

## 更新日志

### v1.0.0 (2026-01-29)
- ✅ 初始版本发布
- ✅ 提示词增删改查功能
- ✅ 分组管理功能
- ✅ 标签系统
- ✅ 搜索和筛选功能
- ✅ 聊天界面集成
- ✅ 支持 OpenAI 和 Anthropic API 格式
- ✅ 默认提示词配置功能

## 反馈和支持

如有问题或建议，请在项目的 GitHub Issues 中提出。
